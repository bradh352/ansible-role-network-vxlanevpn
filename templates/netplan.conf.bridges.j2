{% if network_vxlan_interfaces|default([])|count > 0 or network_bridges|default([])|count > 0 %}
  bridges:
{# Must create a bridge per vxlan. User-specified interface name is bridge name. #}
{# We are assigning IPs, etc to the bridge itself instead of attaching a virtual interface. #}
{%   for interface in network_vxlan_interfaces|default([]) %}
    {{ interface.name }}:
      interfaces:
        - vxlan{{ interface.vni }}
      link-local: [ ]
      mtu: {{ interface.mtu|default(1500) }}
      parameters:
        stp: false
{%     with allow_dhcp_learning=true %}
{%       include "netplan.conf.ip.j2" %}
{%     endwith %}
{%   endfor %}
{%   for interface in network_bridges|default([]) %}
    {{ interface.name }}:
      interfaces:
{%     for phy_interface in interface.interfaces %}
{%       set ifnames = ipfn.resolve_ifnames(ansible_facts, phy_interface) | from_yaml %}
{%       for ifname in ifnames %}
        - {{ ifname }}
{%       endfor %}
{%     endfor %}
      mtu: {{ interface.mtu|default(9000) }}
      parameters:
        stp: true
{%   endfor %}
{% endif %}
