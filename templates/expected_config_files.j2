{% set files = [] %}
{% if ansible_os_family == 'Debian' %}
{%   if network_vtep_ip is defined %}
{%     do files.append("10-lo.network") %}
{%   endif %}
{%   for iface in network_interfaces|default([]) %}
{%     do files.append("10-" ~ iface.name ~ ".link") %}
{%     if iface.name not in network_bridge_iface_names or iface.addresses|default([])|count > 0 or iface.dhcp|default(false) %}
{%       do files.append("10-eth-" ~ iface.name ~ ".network") %}
{%     endif %}
{%   endfor %}
{%   for iface in network_underlay_interfaces|default([]) %}
{%     if iface.is_phy %}
{%       do files.append("10-" ~ iface.name ~ ".link") %}
{%     endif %}
{%     if iface.name not in network_bridge_names + network_bond_names + network_vlan_names %}
{%       do files.append("10-underlay-" ~ iface.name ~ ".network") %}
{%     endif %}
{%   endfor %}
{%   for bond in network_bonds|default([]) %}
{%     do files.append("20-bond-" ~ bond.name ~ ".netdev") %}
{%     for interface in bond.interfaces %}
{%       do files.append("10-" ~ interface.name ~ ".link") %}
{%       do files.append("40-bond-" ~ bond.name ~ "-" ~ interface.name ~ ".network") %}
{%     endfor %}
{%     if bond.name not in network_bridge_iface_names or bond.addresses|default([])|count > 0 or bond.dhcp|default(false) %}
{%       do files.append("60-bond-" ~ bond.name ~ ".network") %}
{%     endif %}
{%   endfor %}
{%   for bridge in network_bridges|default([]) %}
{%     do files.append("30-bridge-" ~ bridge.name ~ ".netdev") %}
{%     for interface in bridge.interfaces|default([]) %}
{%       if interface.is_phy %}
{%         do files.append("10-" ~ interface.name ~ ".link") %}
{%       endif %}
{%       do files.append("50-" ~ interface.name ~ "-attachedto-" ~ bridge.name ~ ".network") %}
{%     endfor %}
{%     do files.append("60-bridge-" ~ bridge.name ~ ".network") %}
{%   endfor %}
{%   for vlan in network_vlans|default([]) %}
{%     do files.append("40-vlan" ~ vlan.vlan ~ "-" ~ vlan.name ~ "-attachedto-" ~ vlan.ifname ~ ".netdev") %}
{%     if vlan.name not in network_bridge_iface_names %}
{%       do files.append("60-vlan" ~ vlan.vlan ~ "-" ~ vlan.name ~ "-attachedto-" ~ vlan.ifname ~ ".network") %}
{%     endif %}
{%   endfor %}
{%   for vxlan in network_vxlans|default([]) %}
{%     do files.append("40-vxlan" ~ vxlan.vni ~ ".netdev") %}
{%     do files.append("50-vxlan" ~ vxlan.vni ~ ('-vlan' ~ vxlan.vlan if vxlan.vlan is defined else '') ~ "-attachedto-" ~ vxlan.ifname ~ ".network") %}
{%   endfor %}
{%   if vxlan_vlan_bridge %}
{%     do files.append("30-vxlan0.netdev") %}
{%     do files.append("40-vxlan0.network") %}
{%   endif %}
{% elif ansible_os_family == 'RedHat' %}
{# We only support basic interfaces on RedHat right now #}
{%   for iface in network_interfaces|default([]) %}
{%     do files.append(iface.name ~ ".nmconnection") %}
{%   endfor %}
{% endif %}
{{- files | sort -}}
