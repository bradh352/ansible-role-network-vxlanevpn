{% set files = [] %}
{% if network_vtep_ip is defined %}
{%   do files.append("10-lo.network") %}
{% endif %}
{% for iface in network_interfaces|default([]) %}
{%   do files.append("10-eth-" ~ iface.name|default(iface.ifname) ~ ".link") %}
{%   if iface.name|default(iface.ifname) not in network_bridge_iface_names or iface.addresses|default([])|count > 0 or iface.dhcp|default(false) %}
{%     do files.append("10-eth-" ~ iface.name|default(iface.ifname) ~ ".network") %}
{%   endif %}
{% endfor %}
{% for iface in network_underlay_interfaces|default([]) %}
{%   if iface.ifname|default("") not in network_bridge_names + network_bond_names + network_vlan_names %}
{%     do files.append("10-underlay-iface" ~ loop.index0 ~ ".link") %}
{%     do files.append("10-underlay-iface" ~ loop.index0 ~ ".network") %}
{%   endif %}
{% endfor %}
{% for bond in network_bonds|default([]) %}
{%   do files.append("20-bond-" ~ bond.name ~ ".netdev") %}
{%   for interface in bond.interfaces %}
{%     do files.append("40-bond-" ~ bond.name ~ "-iface" ~ loop.index0 ~ ".network") %}
{%   endfor %}
{%   if bond.name not in network_bridge_iface_names or bond.addresses|default([])|count > 0 or bond.dhcp|default(false) %}
{%     do files.append("60-bond-" ~ bond.name ~ ".network") %}
{%   endif %}
{% endfor %}
{% for bridge in network_bridges|default([]) %}
{%   do files.append("30-bridge-" ~ bridge.name ~ ".netdev") %}
{%   for interface in bridge.interfaces|default([]) %}
{%     if interface.ifname|default("") not in network_bond_names + network_vlan_names + network_interface_names %}
{%       do files.append("10-bridge-" ~ bridge.name ~ (interface.ifname if interface.ifname is defined else 'iface' ~ loop.index0) ~ ".link") %}
{%     endif %}
{%     do files.append("50-" ~ (interface.ifname if interface.ifname is defined else 'iface' ~ loop.index0) ~ "-attachedto-" ~ bridge.name ~ ".network") %}
{%   endfor %}
{%   do files.append("60-bridge-" ~ bridge.name ~ ".network") %}
{% endfor %}
{% for vlan in network_vlans|default([]) %}
{%   do files.append("40-vlan" ~ vlan.vlan ~ "-" ~ vlan.name ~ "-attachedto-" ~ vlan.ifname ~ ".netdev") %}
{%   do files.append("60-vlan" ~ vlan.vlan ~ "-" ~ vlan.name ~ "-attachedto-" ~ vlan.ifname ~ ".network") %}
{% endfor %}
{% for vxlan in network_vxlans|default([]) %}
{%   do files.append("40-vxlan" ~ vxlan.vni ~ ".netdev") %}
{%   do files.append("50-vxlan" ~ vxlan.vni ~ ('-vlan' ~ vxlan.vlan if vxlan.vlan is defined else '') ~ "-attachedto-" ~ vxlan.ifname ~ ".network") %}
{% endfor %}
{% if vxlan_vlan_bridge %}
{%   do files.append("30-vxlan0.netdev") %}
{%   do files.append("40-vxlan0.network") %}
{% endif %}
{{- files | sort -}}
